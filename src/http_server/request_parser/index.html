



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://ponylang.github.io/http_server/src/http_server/request_parser/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-ponylang-0.2.8">
    
    
      
        <title>Request parser - http_server</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.b80b25f7.css">
      
    
    
      <script src="../../../assets/javascripts/modernizr.0b5df86e.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://ponylang.github.io/http_server/" title="http_server" class="md-header-nav__button md-logo">
          
            <img src="../../../assets/images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                http_server
              </span>
              <span class="md-header-nav__topic">
                Request parser
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../../assets/images/logo.png" width="48" height="48">
      
    </span>
    http_server
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="http_server" class="md-nav__link">
      http_server
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      package http_server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        package http_server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server--index/" title="Package" class="md-nav__link">
      Package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPartUser/" title="primitive URLPartUser" class="md-nav__link">
      primitive URLPartUser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPartPassword/" title="primitive URLPartPassword" class="md-nav__link">
      primitive URLPartPassword
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPartHost/" title="primitive URLPartHost" class="md-nav__link">
      primitive URLPartHost
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPartPath/" title="primitive URLPartPath" class="md-nav__link">
      primitive URLPartPath
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPartQuery/" title="primitive URLPartQuery" class="md-nav__link">
      primitive URLPartQuery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPartFragment/" title="primitive URLPartFragment" class="md-nav__link">
      primitive URLPartFragment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLPart/" title="type URLPart" class="md-nav__link">
      type URLPart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URLEncode/" title="primitive URLEncode" class="md-nav__link">
      primitive URLEncode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-URL/" title="class URL" class="md-nav__link">
      class URL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-SyncHandler/" title="interface SyncHandler" class="md-nav__link">
      interface SyncHandler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-SyncHandlerWrapper/" title="class SyncHandlerWrapper" class="md-nav__link">
      class SyncHandlerWrapper
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Status/" title="interface Status" class="md-nav__link">
      interface Status
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusContinue/" title="primitive StatusContinue" class="md-nav__link">
      primitive StatusContinue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusSwitchingProtocols/" title="primitive StatusSwitchingProtocols" class="md-nav__link">
      primitive StatusSwitchingProtocols
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusOK/" title="primitive StatusOK" class="md-nav__link">
      primitive StatusOK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusCreated/" title="primitive StatusCreated" class="md-nav__link">
      primitive StatusCreated
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusAccepted/" title="primitive StatusAccepted" class="md-nav__link">
      primitive StatusAccepted
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNonAuthoritativeInfo/" title="primitive StatusNonAuthoritativeInfo" class="md-nav__link">
      primitive StatusNonAuthoritativeInfo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNoContent/" title="primitive StatusNoContent" class="md-nav__link">
      primitive StatusNoContent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusResetContent/" title="primitive StatusResetContent" class="md-nav__link">
      primitive StatusResetContent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusPartialContent/" title="primitive StatusPartialContent" class="md-nav__link">
      primitive StatusPartialContent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusMultipleChoices/" title="primitive StatusMultipleChoices" class="md-nav__link">
      primitive StatusMultipleChoices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusMovedPermanently/" title="primitive StatusMovedPermanently" class="md-nav__link">
      primitive StatusMovedPermanently
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusFound/" title="primitive StatusFound" class="md-nav__link">
      primitive StatusFound
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusSeeOther/" title="primitive StatusSeeOther" class="md-nav__link">
      primitive StatusSeeOther
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNotModified/" title="primitive StatusNotModified" class="md-nav__link">
      primitive StatusNotModified
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusUseProxy/" title="primitive StatusUseProxy" class="md-nav__link">
      primitive StatusUseProxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusTemporaryRedirect/" title="primitive StatusTemporaryRedirect" class="md-nav__link">
      primitive StatusTemporaryRedirect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusBadRequest/" title="primitive StatusBadRequest" class="md-nav__link">
      primitive StatusBadRequest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusUnauthorized/" title="primitive StatusUnauthorized" class="md-nav__link">
      primitive StatusUnauthorized
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusPaymentRequired/" title="primitive StatusPaymentRequired" class="md-nav__link">
      primitive StatusPaymentRequired
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusForbidden/" title="primitive StatusForbidden" class="md-nav__link">
      primitive StatusForbidden
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNotFound/" title="primitive StatusNotFound" class="md-nav__link">
      primitive StatusNotFound
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusMethodNotAllowed/" title="primitive StatusMethodNotAllowed" class="md-nav__link">
      primitive StatusMethodNotAllowed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNotAcceptable/" title="primitive StatusNotAcceptable" class="md-nav__link">
      primitive StatusNotAcceptable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusProxyAuthRequired/" title="primitive StatusProxyAuthRequired" class="md-nav__link">
      primitive StatusProxyAuthRequired
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusRequestTimeout/" title="primitive StatusRequestTimeout" class="md-nav__link">
      primitive StatusRequestTimeout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusConflict/" title="primitive StatusConflict" class="md-nav__link">
      primitive StatusConflict
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusGone/" title="primitive StatusGone" class="md-nav__link">
      primitive StatusGone
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusLengthRequired/" title="primitive StatusLengthRequired" class="md-nav__link">
      primitive StatusLengthRequired
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusPreconditionFailed/" title="primitive StatusPreconditionFailed" class="md-nav__link">
      primitive StatusPreconditionFailed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusRequestEntityTooLarge/" title="primitive StatusRequestEntityTooLarge" class="md-nav__link">
      primitive StatusRequestEntityTooLarge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusRequestURITooLong/" title="primitive StatusRequestURITooLong" class="md-nav__link">
      primitive StatusRequestURITooLong
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusUnsupportedMediaType/" title="primitive StatusUnsupportedMediaType" class="md-nav__link">
      primitive StatusUnsupportedMediaType
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusRequestedRangeNotSatisfiable/" title="primitive StatusRequestedRangeNotSatisfiable" class="md-nav__link">
      primitive StatusRequestedRangeNotSatisfiable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusExpectationFailed/" title="primitive StatusExpectationFailed" class="md-nav__link">
      primitive StatusExpectationFailed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusTeapot/" title="primitive StatusTeapot" class="md-nav__link">
      primitive StatusTeapot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusPreconditionRequired/" title="primitive StatusPreconditionRequired" class="md-nav__link">
      primitive StatusPreconditionRequired
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusTooManyRequests/" title="primitive StatusTooManyRequests" class="md-nav__link">
      primitive StatusTooManyRequests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusRequestHeaderFieldsTooLarge/" title="primitive StatusRequestHeaderFieldsTooLarge" class="md-nav__link">
      primitive StatusRequestHeaderFieldsTooLarge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusUnavailableForLegalReasons/" title="primitive StatusUnavailableForLegalReasons" class="md-nav__link">
      primitive StatusUnavailableForLegalReasons
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusInternalServerError/" title="primitive StatusInternalServerError" class="md-nav__link">
      primitive StatusInternalServerError
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNotImplemented/" title="primitive StatusNotImplemented" class="md-nav__link">
      primitive StatusNotImplemented
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusBadGateway/" title="primitive StatusBadGateway" class="md-nav__link">
      primitive StatusBadGateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusServiceUnavailable/" title="primitive StatusServiceUnavailable" class="md-nav__link">
      primitive StatusServiceUnavailable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusGatewayTimeout/" title="primitive StatusGatewayTimeout" class="md-nav__link">
      primitive StatusGatewayTimeout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusHTTPVersionNotSupported/" title="primitive StatusHTTPVersionNotSupported" class="md-nav__link">
      primitive StatusHTTPVersionNotSupported
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-StatusNetworkAuthenticationRequired/" title="primitive StatusNetworkAuthenticationRequired" class="md-nav__link">
      primitive StatusNetworkAuthenticationRequired
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Session/" title="interface Session" class="md-nav__link">
      interface Session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-ServerNotify/" title="interface ServerNotify" class="md-nav__link">
      interface ServerNotify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-ServerConfig/" title="class ServerConfig" class="md-nav__link">
      class ServerConfig
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Server/" title="actor Server" class="md-nav__link">
      actor Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Response/" title="interface Response" class="md-nav__link">
      interface Response
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Responses/" title="primitive Responses" class="md-nav__link">
      primitive Responses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-ResponseBuilder/" title="interface ResponseBuilder" class="md-nav__link">
      interface ResponseBuilder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-ResponseBuilderHeaders/" title="interface ResponseBuilderHeaders" class="md-nav__link">
      interface ResponseBuilderHeaders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-ResponseBuilderBody/" title="interface ResponseBuilderBody" class="md-nav__link">
      interface ResponseBuilderBody
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-BuildableResponse/" title="class BuildableResponse" class="md-nav__link">
      class BuildableResponse
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-TooLarge/" title="primitive TooLarge" class="md-nav__link">
      primitive TooLarge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-UnknownMethod/" title="primitive UnknownMethod" class="md-nav__link">
      primitive UnknownMethod
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-InvalidURI/" title="primitive InvalidURI" class="md-nav__link">
      primitive InvalidURI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-InvalidVersion/" title="primitive InvalidVersion" class="md-nav__link">
      primitive InvalidVersion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-InvalidContentLength/" title="primitive InvalidContentLength" class="md-nav__link">
      primitive InvalidContentLength
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-InvalidTransferCoding/" title="primitive InvalidTransferCoding" class="md-nav__link">
      primitive InvalidTransferCoding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-InvalidChunk/" title="primitive InvalidChunk" class="md-nav__link">
      primitive InvalidChunk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-RequestParseError/" title="type RequestParseError" class="md-nav__link">
      type RequestParseError
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-NeedMore/" title="primitive NeedMore" class="md-nav__link">
      primitive NeedMore
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-ParseReturn/" title="type ParseReturn" class="md-nav__link">
      type ParseReturn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Chunked/" title="primitive Chunked" class="md-nav__link">
      primitive Chunked
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HTTP11RequestHandler/" title="interface HTTP11RequestHandler" class="md-nav__link">
      interface HTTP11RequestHandler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HTTP11RequestParser/" title="class HTTP11RequestParser" class="md-nav__link">
      class HTTP11RequestParser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-CompareCaseInsensitive/" title="primitive CompareCaseInsensitive" class="md-nav__link">
      primitive CompareCaseInsensitive
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-RequestID/" title="type RequestID" class="md-nav__link">
      type RequestID
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-RequestIDs/" title="primitive RequestIDs" class="md-nav__link">
      primitive RequestIDs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HTTP11/" title="primitive HTTP11" class="md-nav__link">
      primitive HTTP11
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HTTP10/" title="primitive HTTP10" class="md-nav__link">
      primitive HTTP10
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HTTP09/" title="primitive HTTP09" class="md-nav__link">
      primitive HTTP09
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Version/" title="type Version" class="md-nav__link">
      type Version
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Request/" title="interface Request" class="md-nav__link">
      interface Request
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-BuildableRequest/" title="class BuildableRequest" class="md-nav__link">
      class BuildableRequest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-MimeTypes/" title="primitive MimeTypes" class="md-nav__link">
      primitive MimeTypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Method/" title="interface Method" class="md-nav__link">
      interface Method
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-CONNECT/" title="primitive CONNECT" class="md-nav__link">
      primitive CONNECT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-GET/" title="primitive GET" class="md-nav__link">
      primitive GET
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-DELETE/" title="primitive DELETE" class="md-nav__link">
      primitive DELETE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HEAD/" title="primitive HEAD" class="md-nav__link">
      primitive HEAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-OPTIONS/" title="primitive OPTIONS" class="md-nav__link">
      primitive OPTIONS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-PATCH/" title="primitive PATCH" class="md-nav__link">
      primitive PATCH
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-POST/" title="primitive POST" class="md-nav__link">
      primitive POST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-PUT/" title="primitive PUT" class="md-nav__link">
      primitive PUT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-TRACE/" title="primitive TRACE" class="md-nav__link">
      primitive TRACE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Methods/" title="primitive Methods" class="md-nav__link">
      primitive Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Header/" title="type Header" class="md-nav__link">
      type Header
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Headers/" title="class Headers" class="md-nav__link">
      class Headers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-Handler/" title="interface Handler" class="md-nav__link">
      interface Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HandlerFactory/" title="interface HandlerFactory" class="md-nav__link">
      interface HandlerFactory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-HandlerWithoutContext/" title="interface HandlerWithoutContext" class="md-nav__link">
      interface HandlerWithoutContext
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../http_server-SimpleHandlerFactory/" title="primitive SimpleHandlerFactory" class="md-nav__link">
      primitive SimpleHandlerFactory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Request parser</h1>
                
                <pre><code class="language-pony-full-source">use &quot;valbytes&quot;
use &quot;debug&quot;

primitive TooLarge is _RequestParseError
  fun string(): String iso^ =&gt; &quot;TooLarge&quot;.clone()

primitive UnknownMethod is _RequestParseError
  fun string(): String iso^ =&gt; &quot;UnknownMethod&quot;.clone()

primitive InvalidURI is _RequestParseError
  fun string(): String iso^ =&gt;
    &quot;InvalidURI&quot;.clone()
primitive InvalidVersion is _RequestParseError
  fun string(): String iso^ =&gt;
    &quot;InvalidVersion&quot;.clone()
primitive InvalidContentLength is _RequestParseError
  fun string(): String iso^ =&gt;
    &quot;InvalidContentLength&quot;.clone()
primitive InvalidTransferCoding is _RequestParseError
  fun string(): String iso^ =&gt;
    &quot;InvalidTransferCoding&quot;.clone()
primitive InvalidChunk is _RequestParseError
  fun string(): String iso^ =&gt;
    &quot;InvalidChunk&quot;.clone()

interface val _RequestParseError is Stringable

type RequestParseError is (( TooLarge | UnknownMethod | InvalidURI | InvalidVersion | InvalidContentLength | InvalidTransferCoding | InvalidChunk ) &amp; _RequestParseError)

primitive NeedMore is Stringable
  fun string(): String iso^ =&gt; &quot;NeedMore&quot;.clone()

type ParseReturn is (NeedMore | RequestParseError | None)
  &quot;&quot;&quot;what is returned from `HTTP11RequestParser.parse(...)`&quot;&quot;&quot;

primitive _ExpectRequestLine
primitive _ExpectHeaders
primitive _ExpectBody
primitive _ExpectChunkStart
primitive _ExpectChunk
primitive _ExpectChunkEnd

type _ParserState is (
  _ExpectRequestLine |
  _ExpectHeaders |
  _ExpectBody |
  _ExpectChunkStart |
  _ExpectChunk |
  _ExpectChunkEnd)


primitive Chunked

interface tag HTTP11RequestHandler
  &quot;&quot;&quot;
  Downstream actor that is notified of parse results,
  be it a valid `Request` containing method, URL, headers and other metadata,
  or a specific `RequestParseError`.
  &quot;&quot;&quot;
  be _receive_start(request: Request val, request_id: RequestID)
    &quot;&quot;&quot;
    Receive parsed Request
    &quot;&quot;&quot;

  be _receive_chunk(data: Array[U8] val, request_id: RequestID)
  be _receive_finished(request_id: RequestID)

  be _receive_failed(parse_error: RequestParseError, request_id: RequestID)

class HTTP11RequestParser
  let _max_request_line_size: USize = 8192 // TODO make configurable
  let _max_headers_size: USize      = 8192 // TODO make configurable
  let _max_chunk_size_line_length: USize = 128 // TODO: make configurable

  let _handler: HTTP11RequestHandler

  var _state: _ParserState = _ExpectRequestLine
  var _buffer: ByteArrays = ByteArrays.create()
  var _request_counter: RequestID = 0
  var _current_request: BuildableRequest trn = BuildableRequest.create()

  var _expected_body_length: USize = 0
  var _persistent_connection: Bool = true
  var _transfer_coding: (Chunked | None) = None

  new create(handler: HTTP11RequestHandler) =&gt;
    _handler = handler

  fun ref parse(data: Array[U8] val): ParseReturn =&gt;
    _buffer = _buffer + (consume data)
    let ret =
      match _state
      | _ExpectRequestLine =&gt;
        _parse_request_line()
      | _ExpectHeaders =&gt;
        _parse_headers()
      | _ExpectBody =&gt;
        _parse_body()
      | _ExpectChunkStart =&gt;
        _parse_chunk_start()
      | _ExpectChunk =&gt;
        _parse_chunk()
      | _ExpectChunkEnd =&gt;
        _parse_chunk_end()
      end
    // signal errors to result receiver
    match ret
    | let rpe: RequestParseError =&gt;
      _handler._receive_failed(rpe, _request_counter)
      reset(where reset_request = true) // TODO: drop data here?
    end
    ret

  fun _skip_whitespace(start: USize = 0): USize =&gt;
    _buffer.skip_while(_HTTP11Parsing~is_whitespace(), start)

  fun _skip_horizontal_space(start: USize = 0): USize =&gt;
    _buffer.skip_while(_HTTP11Parsing~is_horizontal_space(), start)

  fun _request_line_exhausted(): (TooLarge | NeedMore) =&gt;
    if _buffer.size() &gt; _max_request_line_size then
      TooLarge
    else
      NeedMore
    end

  fun _chunk_size_line_exhausted(): (InvalidChunk | NeedMore) =&gt;
    if _buffer.size() &gt; _max_chunk_size_line_length then
      InvalidChunk
    else
      NeedMore
    end

  fun _chunk_trailers_exhausted(): (InvalidChunk | NeedMore) =&gt;
    if _buffer.size() &gt; _max_headers_size then
      InvalidChunk
    else
      NeedMore
    end

  fun _headers_exhausted(): (TooLarge | NeedMore) =&gt;
    if _buffer.size() &gt; _max_headers_size then
      TooLarge
    else
      NeedMore
    end

  fun ref _parse_request_line(): ParseReturn =&gt;
    let start = _skip_whitespace(0)
    if start == USize.max_value() then
      return _request_line_exhausted()
    end

    match _buffer.find(&quot; &quot;, start)
    | (true, let method_end_idx: USize) =&gt;
      let raw_method = _buffer.string(start, method_end_idx)
      let method = Methods.parse(raw_method)
      match method
      | None =&gt; return UnknownMethod
      | let m: Method =&gt;
        _current_request.set_method(m)
      end

      let uri_start = _skip_horizontal_space(method_end_idx + 1)
      if uri_start == USize.max_value() then
        return _request_line_exhausted()
      end
      match _buffer.find(&quot; &quot;, uri_start)
      | (true, let url_end_idx: USize) =&gt;
        let raw_uri = _buffer.string(uri_start, url_end_idx)
        let uri = try
          URL.valid(raw_uri)?
        else
          return InvalidURI
        end
        _current_request.set_uri(uri)

        let version_start = _skip_horizontal_space(url_end_idx + 1)
        if version_start == USize.max_value() then
          return _request_line_exhausted()
        end
        if (_buffer.size() - version_start) &gt;= 8 then
          try
            if (_buffer(version_start)? == 'H') and
              (_buffer(version_start + 1)? == 'T') and
              (_buffer(version_start + 2)? == 'T') and
              (_buffer(version_start + 3)? == 'P') and
              (_buffer(version_start + 4)? == '/') and
              (_buffer(version_start + 5)? == '1') and
              (_buffer(version_start + 6)? == '.')
            then
              var http_minor_version = _buffer(version_start + 7)?
              let http_version =
                match http_minor_version
                | '1' =&gt; HTTP11
                | '0' =&gt; HTTP10
                else
                  // invalid http minor version
                  return InvalidVersion
                end
              _current_request.set_version(http_version)

              // expect CRLF
              if (_buffer(version_start + 8)? != '\r') and (_buffer(version_start + 9)? != '\n') then
                return InvalidVersion
              end
              // trim the buffer
              _buffer = _buffer.drop(version_start + 10)
              _state = _ExpectHeaders
              _parse_headers()

            else
              // invalid http version string
              return InvalidVersion
            end
          else
            _request_line_exhausted()
          end
        else
          // not enough space for http version
          _request_line_exhausted()
        end
      else
        // no whitespace after uri found
        _request_line_exhausted()
      end
    else
      // no whitespace after method found
      _request_line_exhausted()
    end

  fun ref _parse_headers(): ParseReturn =&gt;
    var header_start: USize = 0 // we expect the buffer to be cut off after the request line
    var eoh: Bool = false
    while not eoh do
      match _parse_header(header_start)
      | (let name: String, let value: String, let hend: USize) =&gt;
        _handle_special_headers(name, value)
        _current_request.add_header(name, value)
        header_start = hend
      | let hend: USize =&gt; // EOH
        header_start = hend
        eoh = true // break
      | NeedMore =&gt; return NeedMore
      end
    end
    // EOH
    // drop headers after reaching EOH
    _buffer = _buffer.drop(header_start)

    // send request downstream
    _send_request()

    _state = _ExpectBody
    _parse_body()

  fun ref _send_request() =&gt;
    // send it down to the handler
    _handler._receive_start(
      // resetting the request here already, to pass down a trn
      _current_request = BuildableRequest.create(),
      _request_counter
    )

  fun ref _handle_special_headers(name: String, value: String): ParseReturn =&gt;
    if CompareCaseInsensitive(name, &quot;content-length&quot;) then
      let cl =
        try
          value.usize()?
        else
          return InvalidContentLength
        end
      _current_request.set_content_length(cl)
      _expected_body_length = cl
    elseif CompareCaseInsensitive(name, &quot;transfer-encoding&quot;) then
      try
        value.find(&quot;chunked&quot;)?
        _transfer_coding = Chunked
        _current_request.set_transfer_coding(Chunked)
      else
        return InvalidTransferCoding
      end
    elseif CompareCaseInsensitive(name, &quot;connection&quot;) then
      _persistent_connection = if value == &quot;close&quot; then false else true end
    end
    None

  fun ref _parse_header(start: USize): ((String, String, USize) | NeedMore | RequestParseError | USize) =&gt;
    match _buffer.find(&quot;\r\n&quot;, start)
    | (true, let header_line_end: USize) =&gt;
      if header_line_end == start then
        // we reached end of headers
        return header_line_end + 2
      end

      match _buffer.find(&quot;:&quot;, start, header_line_end)
      | (true, let header_name_end: USize) =&gt;

        let header_name = _buffer.string(start, header_name_end)
        let header_value_start = _skip_horizontal_space(header_name_end + 1)

        try
          (let header_value, let header_end) =
            if (_buffer.size() &gt; (header_line_end + 3)) and _HTTP11Parsing.is_horizontal_space(_buffer(header_line_end + 3)?) then
              // we have a header spanning multiple lines
              let multi_line_value: String trn = recover trn String((header_line_end - header_value_start) * 2) end
              multi_line_value.append(_buffer.string(header_value_start, header_line_end))

              var hend: USize = header_line_end
              var line_start = hend + 3
              while (_buffer.size() &gt; (line_start)) and _HTTP11Parsing.is_horizontal_space(_buffer(line_start)?) do
                let line_value_start = _skip_horizontal_space(line_start)
                match _buffer.find(&quot;\r\n&quot;, line_value_start)
                | (true, let line_end: USize) =&gt;
                  multi_line_value.append(_buffer.string(line_value_start, line_end))
                  hend = line_end
                  line_start = hend + 3
                else
                  return _headers_exhausted()
                end
              end
              (consume multi_line_value, hend)

            else
              // single line header, simple processing, in best case no
              // additional allocation
              (_buffer.string(header_value_start, header_line_end), header_line_end)
            end
          (header_name, header_value, header_end + 2)
        else
          // should never happen, guarded _buffer.apply calls
          return _headers_exhausted()
        end
      else
        // no ':' found
        _headers_exhausted()
      end
    else
      // no CRLF found
      _headers_exhausted()
    end


  fun ref _parse_body(): ParseReturn =&gt;
    match _transfer_coding
    | Chunked =&gt;
      _state = _ExpectChunkStart
      _parse_chunk_start()
    else
      if _expected_body_length &gt; 0 then
        let available = _expected_body_length.min(_buffer.size())
        if available &gt; 0 then
          let data = _buffer.trim(0, available)
          _buffer = _buffer.drop(data.size())
          _expected_body_length = _expected_body_length - data.size()
          _handler._receive_chunk(data, _request_counter)
        end
      end
      if _expected_body_length == 0 then

        _handler._receive_finished(_request_counter)
        reset()
        if _buffer.size() &gt; 0 then
          _parse_request_line()
        end
      else
        NeedMore
      end
    end

  fun ref _parse_chunk_start(): ParseReturn =&gt;
    match _buffer.find(&quot;\r\n&quot;, 0)
    | (true, let chunk_start_line_end: USize) =&gt;
      let chunk_length_end =
        match _buffer.find(&quot;;&quot;, 0, chunk_start_line_end)
        | (true, let cle: USize) =&gt;
          // we found some chunk extensions
          // don't care, YOLO
          cle
        else
          chunk_start_line_end
        end
      let chunk_length_str = _buffer.string(0, chunk_length_end)
      _buffer = _buffer.drop(chunk_start_line_end + 2)
      try
        match chunk_length_str.read_int[USize](0, 16)?
        | (0, 0) =&gt;
          return InvalidChunk // chunk-size is not a hex number
        | (0, _) =&gt;
          // last chunk
          _state = _ExpectChunkEnd
          _parse_chunk_end()
        | (let chunk_length: USize, _) =&gt;
           Debug(&quot;chunk-length: &quot; + chunk_length.string())
           // set valid chunk length
           _expected_body_length = chunk_length
          _state = _ExpectChunk
          _parse_chunk()
        end
      else
        return InvalidChunk // HEX chunk-size integer out of range
      end
    else
      _chunk_size_line_exhausted() // no CRLF found
    end

  fun ref _parse_chunk_end(): ParseReturn =&gt;
    &quot;&quot;&quot;
    handle possible trailer headers (by skipping them) and verify the finishing CRLF.
    &quot;&quot;&quot;
    // search for CRLF ending chunked request
    match _buffer.find(&quot;\r\n&quot;, 0)
    | (true, 0) =&gt;
      // immediate CRLF --&gt; no trailers
      _buffer = _buffer.drop(2) // skip final CRLF
    | (true, let line_end: USize) =&gt;
      // data before CRLF --&gt; trailers
      match _buffer.find(&quot;\r\n\r\n&quot;, line_end)
      | (true, let trailer_end: USize) =&gt;
        // skip trailers and final CRLF
        _buffer = _buffer.drop(trailer_end + 4)
      else
        return _chunk_trailers_exhausted() // trailer line too long or we need more
      end
    else
      return _chunk_trailers_exhausted() // trailer line too long or we need more
    end
    // we got a final CRLF for this chunked request
    _handler._receive_finished(_request_counter)
    reset()
    if _buffer.size() &gt; 0 then
      _parse_request_line()
    end

  fun ref _parse_chunk(): ParseReturn =&gt;
    &quot;&quot;&quot;
    This will not be called for the last-chunk with length 0.
    See _parse_chunk_start.
    &quot;&quot;&quot;
    if _expected_body_length &gt; 0 then
      let available = _expected_body_length.min(_buffer.size())
      if available &gt; 0 then
        let data = _buffer.trim(0, available)
        _buffer = _buffer.drop(data.size())
        _expected_body_length = _expected_body_length - data.size()
        //Debug(&quot;send chunk of size &quot; + data.size().string())
        _handler._receive_chunk(data, _request_counter)
      end
    end
    if _expected_body_length == 0 then
      // end of chunk, expect CRLF, otherwise fail
      try
        if (_buffer(0)? == '\r') and (_buffer(1)? == '\n') then
          _buffer = _buffer.drop(2)
        else
          return InvalidChunk // no CRLF after chunk
        end
      else
        return NeedMore // not enough data for reading a CRLF
      end
      // expect next chunk
      _state = _ExpectChunkStart
      _parse_chunk_start()
    else
      NeedMore
    end

  fun ref reset(
    drop_data: Bool = false,
    reset_request: Bool = false)
  =&gt;
    if reset_request then
      _current_request = BuildableRequest.create()
    end
    _request_counter = _request_counter + 1
    _state = _ExpectRequestLine
    _expected_body_length = 0
    _persistent_connection = true
    _transfer_coding = None
    if drop_data then
      _buffer = ByteArrays.create()
    end

// TODO: handle closed event


primitive _HTTP11Parsing
  &quot;&quot;&quot;
  Common stuff for parsing HTTP/1.1
  &quot;&quot;&quot;
  fun tag is_whitespace(ch: U8): Bool =&gt;
    (ch == 0x09) or (ch == 0x0a) or (ch == 0x0d) or (ch == 0x20)

  fun tag is_horizontal_space(ch: U8): Bool =&gt;
    (ch == 0x09) or (ch == 0x20)


primitive CompareCaseInsensitive
  fun _lower(c: U8): U8 =&gt;
    if (c &gt;= 0x41) and (c &lt;= 0x5A) then
      c + 0x20
    else
      c
    end

  fun apply(left: String, right: String): Bool =&gt;
    &quot;&quot;&quot;
    Returns true if both strings compare equal
    when compared case insensitively
    &quot;&quot;&quot;
    if left.size() != right.size() then
      false
    else
      var i: USize = 0
      while i &lt; left.size() do
        try
          if _lower(left(i)?) != _lower(right(i)?) then
            return false
          end
        else
          return false
        end
        i = i + 1
      end
      true
    end



</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
    <script src="../../../assets/javascripts/application.cb37bb38.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>